# LOAM: Lidar Odometry and Mapping in Real-time

**摘要：**我们提出了一种实时的里程计和测绘方法，该方法使用来自 6 自由度移动的 2 轴激光雷达的距离测量。这个问题很困难，因为距离测量是在不同的时间接收的，并且运动估计中的错误会导致结果点云的错误配准。迄今为止，可以通过离线批处理方法构建连贯的 3D 地图，通常使用闭环来校正随时间的漂移。我们的方法无需高精度测距或惯性测量即可实现低漂移和低计算复杂度。
获得这种性能水平的关键思想是同时定位和映射的复杂问题的划分，该问题旨在通过两种算法同时优化大量变量。一种算法以高频率但低保真度执行里程计来估计激光雷达的速度。另一种算法以低一个数量级的频率运行，用于点云的精细匹配和配准。两种算法的组合允许该方法实时映射。该方法已通过大量实验以及 KITTI 里程计基准进行了评估。
结果表明，该方法可以达到最先进的离线批处理方法水平的准确性。

## 一、引言

3D 映射仍然是一种流行的技术 [1]-[3]。 使用激光雷达进行映射很常见，因为激光雷达可以提供高频范围测量，其中误差相对恒定，而与测量的距离无关。 在激光雷达的唯一运动是旋转激光束的情况下，点云的配准很简单。 然而，如果激光雷达本身在许多感兴趣的应用中移动，则准确的映射需要在连续激光测距期间了解激光雷达的位姿。
解决该问题的一种常见方法是使用独立的位置估计（例如通过 GPS/INS）将激光点注册到固定坐标系中。 另一组方法使用里程计测量，例如来自车轮编码器或视觉里程计系统 [4]、[5] 来记录激光点。
由于里程计随着时间的推移集成了小的增量运动，它必然会漂移，并且很多注意力都集中在减少漂移上（例如使用闭环）。

在这里，我们考虑使用以 6 自由度移动的 2 轴激光雷达创建具有低漂移里程计的地图的情况。 使用激光雷达的一个关键优势是它对场景中的环境照明和光学纹理不敏感。 激光雷达的最新发展减少了它们的尺寸和重量。 激光雷达可以由穿越环境的人持有 [6]，甚至可以连接到微型飞行器 [7]。 由于我们的方法旨在推动与最小化里程估计漂移相关的问题，因此它目前不涉及闭环。

该方法无需高精度测距或惯性测量即可实现低漂移和低计算复杂度。获得这种性能水平的关键思想是将同时定位和映射 (SLAM) [8] 的典型复杂问题进行划分，该问题旨在通过两种算法同时优化大量变量。一种算法以高频率但低保真度执行里程计来估计激光雷达的速度。另一种算法以低一个数量级的频率运行，用于点云的精细匹配和配准。
虽然没有必要，但如果 IMU 可用，则可以提供运动先验来帮助解释高频运动。具体而言，两种算法都提取位于锐边和平面上的特征点，并将特征点与边缘线段和平面匹配补丁，分别。
在里程计算法中，通过确保快速计算来找到特征点的对应关系。在映射算法中，对应关系是通过检查局部点簇的几何分布，通过相关的特征值和特征向量来确定的。

L通过分解原始问题，首先解决了一个更简单的问题，即在线运动估计。 之后，映射作为批量优化（类似于迭代最近点 (ICP) 方法 [9]）进行，以生成高精度运动估计和映射。 并行算法结构保证了实时解决问题的可行性。 此外，由于运动估计是以更高的频率进行的，因此映射有足够的时间来提高准确性。
当以较低频率运行时，映射算法能够结合大量特征点并使用足够多的迭代来收敛。

## 二 相关工作

激光雷达已成为机器人导航中有用的距离传感器 [10]。对于定位和映射，大多数应用程序使用 2D 激光雷达 [11]。当激光雷达扫描速率与其外部运动相比较高时，扫描内的运动失真通常可以忽略不计。在这种情况下，标准 ICP 方法 [12] 可用于匹配不同扫描之间的激光回波。
此外，提出了一种两步方法来消除失真 [13]：基于 ICP 的速度估计步骤之后是失真补偿步骤，使用计算的速度。类似的技术也用于补偿单轴 3D 激光雷达 [14] 引入的失真。但是，如果扫描运动相对较慢，则运动失真可能会很严重。使用 2 轴激光雷达时尤其如此，因为一个轴通常比另一个轴慢得多。通常，其他传感器用于提供速度测量，从而可以消除失真。例如，激光雷达云可以通过与 IMU 集成的视觉里程计的状态估计来注册 [15]。当 GPS/INS 和车轮编码器等多个传感器同时可用时，通常通过扩展卡尔曼滤波器 [16] 或粒子滤波器 [1] 来解决问题。这些方法可以实时创建地图，以辅助机器人导航中的路径规划和避碰。

如果在没有其他传感器帮助的情况下使用 2 轴激光雷达，运动估计和失真校正将成为一个问题。 Barfoot 等人使用的一种方法。 是从激光强度返回创建视觉图像，并在图像之间匹配视觉上不同的特征[17]，以恢复地面车辆的运动[18]-[21]。 车辆运动在 [18]、[19] 中被建模为恒定速度，在 [20]、[21] 中使用高斯过程建模。 我们的方法在里程计算法中使用与 [18]、[19] 类似的线性运动模型，但具有不同类型的特征。 方法 [18]-[21] 涉及来自强度图像的视觉特征，并且需要密集的点云。 我们的方法在笛卡尔空间中提取和匹配几何特征，对云密度的要求较低。

最接近我们的方法是 Bosse 和 Zlot [3]、[6]、[22] 的方法。他们使用 2 轴激光雷达来获取点云，该点云通过匹配局部点簇的几何结构来注册 [22]。此外，他们使用多个 2 轴激光雷达来绘制地下矿井地图 [3]。这种方法结合了 IMU 并使用闭环来创建大地图。 Zebedee 由同一作者提出，是一种测绘设备，由 2D 激光雷达和通过弹簧连接到手杆的 IMU 组成 [6]。映射是通过用手点头设备进行的。轨迹通过批处理优化方法恢复，该方法处理分段数据集，在分段之间添加边界约束。在该方法中，IMU 的测量值用于配准激光点，优化用于校正 IMU 偏差。本质上，Bosse 和 Zlot 的方法需要批处理来开发准确的地图，因此不适合需要实时地图的应用。相比之下，所提出的实时方法生成的地图在质量上与 Bosse 和 Zlot 的相似。区别在于我们的方法可以为自动驾驶汽车的引导提供运动估计。此外，该方法利用了激光雷达扫描模式和点云分布。实现了特征匹配，分别确保了里程计和映射算法的计算速度和准确性。

## 三、 符号和任务描述 

本文解决的问题是使用 3D 激光雷达感知的点云进行自我运动估计，并为遍历的环境构建地图。 我们假设激光雷达已经过预校准。 我们还假设激光雷达的角速度和线速度随着时间的推移是平滑和连续的，没有突然变化。 第二个假设将在第 VII-B 节中通过使用 IMU 来发布。

作为本文的惯例，我们使用右大写上标来表示坐标系。 我们将扫描定义为激光雷达完成一次扫描覆盖。 我们使用右订阅 k，k ∈ Z + 表示扫描，P k 表示在扫描 k 期间感知的点云。 让我们定义两个坐标系如下。

- 激光雷达坐标系 {L} 是一个 3D 坐标系，其原点位于激光雷达的几何中心。 x 轴指向左侧，y 轴指向上方，z 轴指向前方。 {L k } 中点 i 的坐标 i ∈ P k 表示为 X L(k,i) 。
- 世界坐标系 {W } 是在初始位置与 {L} 重合的 3D 坐标系。 {W k } 中点 i, i ∈ P k 的坐标是 X W(k,i) 。

有了假设和符号，我们的激光雷达里程计和映射问题可以定义为:

问题：给定一系列激光雷达云 P k , k ∈ Z + ，计算激光雷达在每次扫描 k 期间的自我运动，并用 P k 为遍历的环境构建地图。

## 四  系统总览

### A. 激光雷达硬件 

本文的研究在但不限于基于 Hokuyo UTM-30LX 激光扫描仪的定制 3D 激光雷达上进行了验证。 通过本文，我们将使用从激光雷达收集的数据来说明该方法。 激光扫描仪的视野为 180°，分辨率为 0.25°，扫描速率为 40 线/秒。
激光扫描仪连接到电机，电机被控制以 180°/s 的角速度在 -90° 和 90°之间旋转，激光扫描仪的水平方向为零。
使用这个特定的单位，扫描是从 -90° 到 90° 或反向旋转（持续 1 秒）。 在这里，请注意，对于连续旋转的激光雷达，扫描只是一个半球形旋转。 板载编码器以 0.25° 的分辨率测量电机旋转角度，激光点被投影到激光雷达坐标 {L} 中。

### B. 软件系统概述

图 3 显示了软件系统的示意图。 设 P̂ 为激光扫描中接收到的点。 在每次扫描期间，P̂ 记录在 {L} 中。 扫描 k 期间的组合点激光云形成 P k 。 然后，P k 用两种算法处理。 激光雷达里程计采用点云并计算激光雷达在两次连续扫描之间的运动。 估计的运动用于校正 P k 中的失真。 该算法以大约 10Hz 的频率运行。 激光雷达映射进一步处理输出，该映射以 1Hz 的频率将未失真的云匹配并注册到地图上。 最后，将两种算法发布的位姿变换相结合，以生成关于激光雷达相对于地图的位姿的 10Hz 左右的变换输出。 第五节和第六节详细介绍了软件图中的模块。

## 五、激光雷达测距

### A. 特征点提取

我们首先从激光雷达云 P k 中提取特征点。 图 2 中的激光雷达自然会在 P k 中生成不均匀分布的点。 来自激光扫描仪的回波在一次扫描内具有 0.25 ◦ 的分辨率。 这些点位于扫描平面上。 然而，由于激光扫描仪以 180°/s 的角速度旋转并产生 40Hz 的扫描，因此垂直于扫描平面方向的分辨率为 180°/40 = 4.5°。 考虑到这一事实，特征点是从 P k 中提取的，仅使用来自单个扫描的信息，具有共面几何关系。

我们选择位于锐利边缘和平面表面补丁上的特征点。 令 i 为 P k 中的一个点，i ∈ P k ，令 S 为激光扫描仪在同一扫描中返回的 i 的连续点的集合。 由于激光扫描仪以 CW 或 CCW 顺序生成点返回，因此 S 在 i 的每一侧包含其一半的点，并且两点之间的间隔为 0.25°。 定义一个术语来评估局部表面的平滑度，

根据 c 值对扫描中的点进行排序，然后选择 c 最大的特征点，即边缘点，和最小 c 的特征点，即平面点。 为了在环境中均匀分布特征点，我们将扫描分成四个相同的子区域。 每个子区域最多可以提供2个边缘点和4个平面点。
A 点 i 只有当其 c 值大于或小于阈值，且选取的点数不超过最大值时，才能被选为边缘点或平面点。

在选择特征点时，我们要避免选择包围点的点，或者局部平面Plane上的点到激光束（图4（a）中大致平行扫描的点B表面）。 这些点通常被认为是不可靠的。 激光 此外，我们希望避免位于遮挡区域边界上的点 [23]。 一个例子如图 4(b) 所示。 点 A 是激光雷达云中的一个边缘点，因为它的连接表面（虚线段）被另一个物体挡住了。 但是，如果激光雷达移动到另一个视点，被遮挡的区域可能会发生变化并变得可观察到。 为避免上述点被选中，我们再次找到点集合 S。只有当 S 没有形成大致平行于激光束的曲面片时，才能选择点 i，并且 S 中没有点 在激光束的方向上与 i 有一个间隙，同时离激光雷达更近，然后是点 i（例如图 4（b）中的点 B）。 

综上所述，特征点从c值最大开始选择为边缘点，c值从最小开始选择平面点，如果选择了一个点，
• 所选边缘点或平面点的数量不能超过子区域的最大值，并且
• 它的周围点都没有被选中，并且
• 它不能位于与激光束大致平行的表面块上，或位于遮挡区域的边界上。
从走廊场景中提取的特征点示例如图 5 所示。边缘点和平面点分别用黄色和红色标记。

### B. 寻找特征点对应关系

里程计算法估计激光雷达在一次扫描中的运动。 令 t k 为扫描 k 的开始时间。 在每次扫描结束时，扫描过程中感知到的点云，

P k 被重新投影到时间戳 t k+1 ，如图 6 所示。
我们将重新投影的点云表示为 P̄ k 。 在下一次扫描 k+1 期间，P̄ k 与新接收的点云 P k+1 一起用于估计激光雷达的运动。



## 六 激光雷达测绘



## 七 实验

在实验期间，处理激光雷达数据的算法在 Linux 中的机器人操作系统 (ROS) [29] 上运行在具有 2.5GHz 四核和 6Gib 内存的笔记本电脑上。该方法总共消耗两个核心，里程计和映射程序在两个独立的核心上运行。我们的软件代码和数据集是公开的 1,2。

### A. 室内和室外测试

该方法已在室内和室外环境中进行了测试。在室内测试期间，激光雷达与电池和笔记本电脑一起放置在推车上。一个人推着车走。图 10(a) 和图 10(c) 显示了在两个有代表性的室内环境中构建的地图，一个狭窄而长的走廊和一个大大厅。图 10(b) 和图 10(d) 显示了从相同场景拍摄的两张照片。在户外测试中，激光雷达安装在地面车辆的前部。图 10(e) 和图 10(g) 显示了从两行树木之间的植被道路和果园生成的地图，照片分别显示在图 10(f) 和图 10(h) 中。在所有测试中，激光雷达以 0.5m/s 的 1 速度移动。

为了评估地图的局部准确性，我们从相同的环境中收集了第二组激光雷达云。 激光雷达是扫描和平面放置在几个不同的地方，在数据选择期间在每个环境中保持静止。
使用点对面ICP方法[9]对两个点云进行激光匹配和比较。 匹配完成后，将一个点云与第二个点云中对应的平面块之间的距离视为匹配误差。 图 11 显示了误差分布的密度。 它表明室内环境中的匹配误差比室外环境小。 结果是合理的，因为自然环境中的特征匹配不如人造环境中精确。

此外，我们进行测试以测量运动估计的累积漂移。 我们选择包含闭环的室内实验走廊。 这使我们可以在同一个地方开始和结束。 运动估计会在起始位置和结束位置之间产生一个间隙，该间隙指示漂移量。 对于户外实验，我们选择果园环境。 携带激光雷达的地面车辆配备了高精度 GPS/INS，用于获取地面实况。 将测量的漂移与作为相对精度的行进距离进行比较，并在表 I 中列出。具体而言，测试 1 使用与图 10(a) 和图 10(g) 相同的数据集。 一般而言，室内测试具有相对准确度
大约 1%，户外测试大约是 2.5%。

### B. IMU 的协助 

我们将 Xsens MTi-10 IMU 连接到激光雷达以应对快速的速度变化。 点云在发送到所提出的方法之前以两种方式进行预处理，1) 使用来自 IMU 的方向，在一次扫描中接收到的点云被旋转以与该扫描中激光雷达的初始方向对齐，2) 使用加速度测量 ，运动失真被部分消除，就好像激光雷达在扫描过程中以恒定速度移动一样。 然后由激光雷达里程计和映射程序处理点云。

IMU 方向是通过在卡尔曼滤波器 [1] 中集成来自陀螺仪的角速率和来自加速度计的读数来获得的。 图 12(a) 显示了一个示例结果。 一个人拿着激光雷达走在楼梯上。 在计算红色曲线时，我们使用 IMU 提供的方向，我们的方法只估计平移。 在 5 分钟的数据收集过程中，方向漂移超过 25°。 假设没有可用的 IMU，绿色曲线仅依赖于我们方法中的优化。 蓝色曲线使用 IMU 数据进行预处理，然后是所提出的方法。 我们观察到绿色和蓝色曲线之间的微小差异。 图 12(b) 给出了对应于蓝色曲线的图。 在图 12（c）中，我们比较了图 12（b）中黄色矩形中地图的两个闭合视图。 上图和下图分别对应蓝色和绿色曲线。 仔细对比发现，上图的边缘更加锐利。

表 II 比较了使用和不使用 IMU 的运动估计的相对误差。 激光雷达由一个人以 0.5m/s 的速度行走并以 0.5m 左右的幅度上下移动激光雷达。 基本事实是由卷尺手动测量的。 在所有四个测试中，在 IMU 的帮助下使用所提出的方法可以获得最高的准确度，而使用 IMU 的方向只会导致最低的准确度。 结果表明，IMU有效地消除了非线性运动，所提出的方法利用它来处理线性运动。

### C. 使用 KITTI 数据集进行测试

我们还使用来自 KITTI 里程计基准 [30]、[31] 的数据集评估了我们的方法。 数据集与安装在结构化道路上行驶的乘用车顶部的传感器仔细注册（图 13（a））。 该车辆配备了 360 ◦ Velodyne 激光雷达、彩色/单色立体摄像头和用于地面实况的高精度 GPS/INS。 激光雷达数据以 10Hz 记录，并由我们的方法用于里程计估计。 由于篇幅问题，我们无法将结果包括在内。 但是，我们鼓励读者在基准网站 3 上查看我们的结果。

数据集主要涵盖三类环境：周围有建筑物的“城市”、场景中有植被的小路上的“乡村”以及道路较宽且周围环境相对干净的“高速公路”。 图 13(b) 显示了一个示例激光雷达云和来自城市环境的相应视觉图像。 数据集中包含的总行驶距离为 39.2 公里。 上传车辆轨迹后，基准服务器会自动计算准确性和排名。 我们的方法在基准评估的所有方法中排名第一，无论传感方式如何，包括最先进的立体视觉里程计 [32]、[33]。 平均位置误差是行进距离的 0.88%，使用 3D 坐标中 100m、200m、...、800m 长度的轨迹段生成。

## 八 结论和未来工作

使用来自旋转激光扫描仪的点云进行运动估计和映射可能很困难，因为该问题涉及激光雷达云中运动的恢复和运动失真的校正。所提出的方法通过并行运行的两种算法来划分和解决问题：激光雷达里程计进行粗略处理以估计较高频率的速度，而激光雷达映射执行精细处理以在较低频率创建地图。两种算法的合作允许实时准确的运动估计和映射。此外，该方法可以利用激光雷达扫描模式和点云分布。进行特征匹配以确保里程计算法中的快速计算，并增强映射算法的准确性。该方法已在室内和室外以及 KITTI 里程计基准上进行了测试。
由于当前的方法不能识别闭环，我们未来的工作包括开发一种通过闭环来修复运动估计漂移的方法。此外，我们将我们方法的输出与卡尔曼滤波器中的 IMU 集成，以进一步减少运动估计漂移。