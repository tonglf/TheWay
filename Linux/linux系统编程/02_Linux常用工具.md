## Linux 常用工具

## vim 编辑器

### vim 的三种工作模式

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210623193501165.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTg2NzM4Mg==,size_16,color_FFFFFF,t_70)

vim 编辑器有三种工作模式，分别是==命令模式==、==文本模式==、==末行模式==。一开始打开 vim 默认是命令模式，命令模式可以切换进入文本模式和末行模式，但是文本模式和末行模式之间不能进行切换。

### vim 编辑器的配置

vim 编辑器的自动缩进是8个空格，且没有行号，需要进入配置文件进行修改。

ubuntu20.04 的 vimrc 位置在 /etc/vim/vimrc

使用 **sudo vim /etc/vim/vimrc** 进入配置文件，在文件末尾添加：

```c++
set tabstop=4  		// 设置制表符宽度为4
set softtabstop=4 	// 设置软制表符宽度为4
set shiftwidth=4  	// 设置缩进空格数为4
set nu				// 设置显示行号
```

保存退出，再次利用 vim 打开文件，行号、缩进都改变了。

### vim 的基本操作

#### 跳转和删除字符

**i 进入编辑模式，光标前插入字符**

**a 进入编辑模式，光标后插入字符**

o 进入编辑模式，光标所在行的下一行插入

I 进入编辑模式，光标所在行的行首插入

A 进入编辑模式，光标所在行的行末插入字符

O 进入编辑模式，光标所在行的上一行插入字符

s 删除光标所在字符并进入编辑模式

S 删除光标所在行并进入编辑模式

 

**x 删除光标所在字符，工作模式不变**

dw 删除光标所在单词，要求光标在首字母上，如果不在首字母，只会删除当前位置到单词末，工作模式不变

D 删除光标所在位置到行末，工作模式不变

**0(数字) 光标移到行首，工作模式不变**

**$ 光标移到行尾，工作模式不变**

**d0 删除光标所在位置到行首，工作模式不变**

**d$ 删除光标所在位置到行末，工作模式不变**



**命令模式下的光标移动**

- h 左移

- j 下移

- k 上移

- l 右移

**命令模式下行跳转**

- line-G 缺点是没有回显（ line 表示输入的行号）

**末行模式下行跳转**

- :line-回车

**跳转首行**

- gg （命令模式）

**跳转末行**

- G （命令模式）

**括号跳转**

- 命令模式下，光标处于左大括号时，使用%跳转到对应右大括号，再按%跳回去。

#### 删除

**替换单个字符**

- r 命令模式下替换光标选中字符

**一段删除，即删除指定区域**

- 光标选中要删除的首字符，**按v进入可视模式**，再使用hjkl移动到要删除的末尾，按d删除

**删除整行：**

- dd，删除光标所在行，本意是**剪切**

- n+dd ，删除从光标开始的n行

#### 复制粘贴

**yy 复制光标所在行**

p 向后粘贴剪切板内容，如果复制整行，这里是粘贴在光标所在位置的下一行

P 向前粘贴剪切板内容，如果是整行，这里是粘贴在光标所在位置的上一行

 

这里提一下，上一节里的dd，不是删除，而是剪切，消失的内容去了剪切板，而不是删掉了

p和P粘贴会出现换行，主要原因是复制整行时，会把行末的换行符也复制下来。

 

**n-yy 复制光标所在位置的n行，包括光标所在行**

#### 查找和替换

**查找**

/+findname  命令模式下查找

按回车键启动查找后，按n，会自动找下一个，N跳到上一个

查找光标所在单词

光标在目标单词上时，*或者#查找下一个，这里不要求光标必须在首字母上

**替换：末行模式下进行**

**单行替换**  

- 光标置于待替换行，  :s /待替换词/替换词

 **全文替换**

- :%s /待替换词/替换词      这个默认替换每行的首个，一行有多个目标词时，后面的不会变

- :%s /待替换词/替换词/g    真正意义上的全局替换

**区域替换**

- :24,35s /待替换词/替换词/g   替换24-35行之间的目标词

**末行模式下历史命令**

- Ctrl-p 上一条命令

- Ctrl-n 下一条命令

#### 其他

**撤销与反撤销**

- 命令模式下
  - u 撤销操作
  - Ctrl-r 反撤销

**分屏，末行模式下**

- :sp  水平分屏

- :vsp 竖直分屏

- 分屏命令+filename，分屏并打开这个文件

- 分屏后屏幕切换，Ctrl-w-w

- 使用:q退出光标所在窗口

- 使用:qall退出所有窗口

**从vim中跳转manpage，命令模式下**

- 将光标放在待查看单词上，按K，默认看第一卷

- n+K，查看第n卷

**查看宏定义：命令模式**

- 光标放在待查看词上，[+d即可查看

**vim下使用shell命令：末行模式**

- :! + 命令

  操作后，会切换至终端显示结果，按Enter后回到vim界面

## gcc 编译

### gcc 编译 4 步骤

4步骤： 预处理、编译、汇编、连接。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210623195106969.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTg2NzM4Mg==,size_16,color_FFFFFF,t_70)

### gcc 编译常用参数

-I     指定头文件所在目录位置(大写的i)

-E    只做预处理，得到 `.i ` 文件

-S    只做预处理，编译，得到 `.s` 文件

-c     只做预处理，编译，汇编。得到二进制文件 `.o ` 文件

-o	对生成的文件重命名

-g     编译时添加调试文件，用于gdb调试

-Wall    显示所有警告信息

-D     向程序中“动态”注册宏定义

-l     指定动态库库名(小写的L)

-L     指定动态库路径

## 静态库与动态库的制作

### 动态库和静态库理论对比

- 静态库在文件中静态展开，所以有多少文件就展开多少次，非常吃内存，100M展开100次，就是1G，但是这样的好处就是静态加载的速度快

- 使用动态库会将动态库加载到内存，10个文件也只需要加载一次，然后这些文件用到库的时候临时去加载，速度慢一些，但是很省内存

- 动态库和静态库各有优劣，根据实际情况合理选用即可。

> 静态库：对空间要求低，而时间要求较高的核心程序中
>
> 动态库：对时间要求较低，对空间要求较高

### 静态库的制作

**静态库制作及使用步骤：**

1. 将 .c 生成 .o 文件

   gcc -c add.c -o add.o

2. 使用 ar 工具制作静态库

   ar rcs  lib库名.a  add.o sub.o div.o

3. 编译静态库到可执行文件中：

   gcc test.c lib库名.a -o a.out

**注意**：

​		主程序需要包含库的头文件，一般使用库或制作库时给出，在编译时加入   -I 头文件路径

**头文件守卫：防止头文件被重复包含**

```cpp
#ifndef _HEAD_H_
#define _HEAD_H_

	......

#endif
```

### 动态库的制作

**动态库制作及使用：**

1. 将 .c 生成 .o 文件， （生成与位置无关的代码 -fPIC）

​       gcc -c add.c -o add.o -fPIC

2. 使用 gcc -shared 制作动态库

​       gcc -shared -o lib库名.so add.o sub.o div.o

3. 编译可执行程序时，指定所使用的动态库。 

-l：指定库名(去掉lib前缀和.so后缀) -L：指定库路径。l和L后面有无空格均可

​       gcc test.c -o a.out -l mymath -L ./lib

4. 运行可以执行程序 ./a.out 出错！！！！ --- ldd a.out --> "not found"

​       error while loading shared libraries: libxxx.so: cannot open shared object file: No such file or directory

​       原因：

​           链接器：   工作于链接阶段，工作时需要 -l 和 -L

​           动态链接器：  工作于程序运行阶段，工作时需要提供动态库所在目录位置。

​       **解决方式：**           

​           【1】 通过环境变量： export LD_LIBRARY_PATH=动态库路径

​              ./a.out 成功！！！ （临时生效， 终端重启环境变量失效）

​           【2】 永久生效： 写入终端配置文件。 .bashrc 建议使用绝对路径。

​              1) vi ~/.bashrc

​              2) 写入 export LD_LIBRARY_PATH=动态库路径 保存

​              3）. .bashrc或 source .bashrc 或重启终端 ---> 让修改后的.bashrc生效

​              4）./a.out 成功！！！ 

​           【3】 拷贝自定义动态库到 /lib (标准C库所在目录位置)（不建议此操作，不要随意更改根目录下的文件）

​           【4】 配置文件法

​              1）sudo vi /etc/ld.so.conf

​              2) 写入 动态库绝对路径 保存

​              3）sudo ldconfig -v 使配置文件生效。

​              4）./a.out 成功！！！--- 使用 ldd a.out 查看

**注意事项：**

1. 动态库是否加载到内存，取决于程序是否运行

2. 动态库每次加载的位置不确定

3. 动、静态库共有时，编译器首先使用动态库
